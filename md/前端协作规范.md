# 新项目总体流程

tudo

## 负责人职责

- 需要了解客户需求，理解产品设计，清晰地明白项目的完整业务流。
- 能够对不合理的需求提出质疑，对不够好的设计方案提出建议。
- 能够评估项目风险，包括时间、技术、部门外部因素等。
- 能够基本准确地评估人力成本，完成任务的拆解与分配。
- 能主动协调后端开发人员、产品、UI 设计人员、测试等推进项目。
- 能对组内其它开发人员的代码负责，可以随时接手或安排其他人接手。
- 能使用 Git 工具管理好项目的各个版本。

## 开发前置工作

- 为项目各端下载空的 Git 仓库（如仓库未建立则需按以下步骤新建）
  - 在 `front-end` 大组下用项目/客户名称新建子组（new subgroup），并在描述中填写项目/客户中文名称。
  - 在设置 - CI/CD 的 `variable` 中新建 key 为 `SUBGROUP_NAME` 且值为上一步填写的子组名称的变量。
  - 为项目填写描述，格式为 `xx 项目 xx 端`。
  - 在设置 - CI/CD 的 `variable` 中新建 key 为 `APP_NAME` 且值为上一步填写的项目名称的变量。
- 为各端初始化工程，目前按是否使用低代码平台分为两种情况：
  - 使用低代码平台，参考 [前端低代码平台使用说明]。
  - 不使用低代码平台，需要下载应用工程模板文件。(复制到浏览器地址打开)
    - [工程模板](http://192.168.6.252:7080/front-end/common/front-example/-/archive/master/front-example-master.zip)
- 提交到 Git 仓库。
- 为了方便自动部署，包管理工具统一使用 `yarn`。

## 代码管理

### 文件目录

- 对于使用了低代码平台的项目，在根目录下（与 `src` 同级）建立 `mtx` 文件夹，保存 `mtx` 数据包的解压文件。

### 分支结构

- **master** - 主分支，与发布版本维持一致，不可直接在此分支上开发，仅允许 `develop` 向此分支合并。
- **develop** - 开发主分支，与内网版本维持一致，可通过 `cicd` 自动打包，不可直接在此分支上开发，仅允许 `feature` 向此分支合并。
- **feature** - 功能开发分支目录。
  - `feature-name` - 以功能命名 `kebab-case` 的功能开发分支。
- **release** - 版本发布分支目录。
  - `1.0.0` - 与 `package.json` 中的版本号保持一致，以 `major.minor.patch` 命名，其中 `major` 代表大版本更新（客户签订新合同），`minor` 为功能更新（验收通过后的每次功能需求单），`patch` 为 bug 修复（也包括通过客户首次验收前所有向客户发包的功能改动），在有改动情况下前后端需保持一致，具体规则参照 [软件版本规范]。

## 功能开发

1. 需求确认后根据功能模块决定分支名称，从 `develop` 分支最新节点检出。
2. 该功能分支可推送到远端，方便其它成员协同开发。
3. 功能完成或有阶段性成果时，才可向 `develop` 分支合并。
4. 当功能实现周期较长，不在迭代计划内时，禁止向 `develop` 分支合并。
5. `develop` 分支被合并后，会自动向开发环境部署，地址格式为 `http://192.168.200.1/dev-{git项目名}/`。

## 版本创建

1. 当迭代计划中的功能均已向 `develop` 分支合并完成后，对 `develop` 分支进行自我测试。
2. 测试通过后从 `develop` 分支最新节点检出新的 `release` 分支，以新的 `release/major.minor.patch` 命名（如 `release/1.0.0`），然后修改代码层面版本号，并说明本次版本距离上一版本的改动内容，作为 `release` 分支中的首次提交。
3. 一般新立项的项目版本从 `1.0.0` 开始，客户通过首次验收前均只提升 `patch` 版本，即 `1.0.x`。
4. 如在测试过程中发现重大问题导致某些功能无法正常发布时，需要对应的开发人员创建自己代码的回滚，然后重新测试，测试完成后重新提交到 `develop` 并合并至 `release`。
5. `release` 分支被合并后，会自动向预发布环境部署，地址格式为 `http://192.168.200.1/{git项目名}/`。

## 版本发布

1. 确认版本分支没有问题后，保留版本分支，删除对应的功能开发分支。
2. 将当前版本的所有改动说明连同版本号发送给测试留存。
3. 版本发布后，将 `develop` 分支合并至 `master` 分支，测试至版本发布期间不允许有新的功能分支合并至 `develop` 分支。

## bug 修复

1. 如为当前迭代产生的 bug，可直接在功能分支上进行修改，修改后重新向 `develop` 分支合并。
2. 如为历史版本的 bug，视影响版本的改动情况，各版本改动差异较大的可直接在各版本分支和 `develop` 分支检出不同的 `feature` 分支进行修复与合并；改动差异较小的，需要从待修复版本中最早的版本分支创建修复补丁，然后往各个版本和 `develop` 进行应用。

## 代码提交

1. 每次代码提交前，必须确认已经完成以下内容：
   - **自测流程**：自测环节包括 UI 稿校验、后端接口测试、页面操作测试、边界条件测试。
   - **改动代码确认**：确认需要提交的代码不含有临时代码，建议使用 GUI 工具确认。
2. 代码提交的说明格式为：
   - `add`: 增加功能/依赖/配置
   - `del`: 删除功能/依赖/配置
   - `update`: 修改功能/依赖/配置
   - `fix`: bug 修改
   - `doc`: 增加文档/注释
   - `test`: 增加调试功能
   - `revert`: 回滚功能
   - `merge`: 合并功能

代码推送时，先拉取待合并的最新远端分支，再以变基方式对自己的 `feature` 分支进行合并，最后将自己的代码合并到远端分支并推送。

## 代码合并 rebase

**远端分支**：`develop`  
**开发分支（你的分支）**：`feature/xxx`

### 前提：

1. （代码规范要求）新功能、BUG 等代码改动在新分支上提交。
2. 保证 `develop` 分支与远端 `develop` 同源（不存在未推送的本地提交）。若存在，请先解决。

### 操作步骤：

1. 将代码提交至开发分支 `feature/xxx`。
   - 提交所有代码至暂存区：
     
     ```bash
     git add .
     ```
     
   - 确认提交信息，请写明此次提交内容：

     ```bash
     git commit -m 'add: 你做了些xxxxxx'
     ```
     
   - 若部分代码仍需保留在本地，请先贮存无关代码，再执行后续操作（所有代码都提交可忽略此操作）：

     ```bash
     git stash
     ```

2. 同步远端与本地分支 `develop`。
   - 拉取远端的 `develop` 到本地 `develop`：

     ```bash
     git fetch origin develop:develop
     ```

3. `feature/xxx` 向 `develop` 变基。
   - 变基操作：

     ```bash
     git rebase develop
     ```

   - 远端代码和本地代码对同一处进行修改时会出现冲突，若出现冲突，请解决：

     ```bash
     git add .
     git rebase --continue
     ```

   - 出现需要修改的合并记录，按 `ZZ` 或 `:wq!` 退出。

4. 切到 `develop` 分支上合并代码并推送：
   - 切换分支：

     ```bash
     git checkout develop
     ```
     
   - 合并 `feature/xxx` 至 `develop`：

     ```bash
     git merge feature/xxx
     ```
     
   - 推送到远端：

     ```bash
     git push origin develop
     ```
     
   - 记得切回到自己分支。
