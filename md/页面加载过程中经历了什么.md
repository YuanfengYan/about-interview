# 页面加载过程中经历了什么

## 基础介绍

(uri)统一资源定位符的标准格式如下：协议类型:[//服务器地址[:端口号]][/资源层级UNIX文件路径]文件名[?查询][#片段ID]  

DNS(域名系统)：是互联网的一项服务。它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网  

IP寻址过程：

- 浏览器会从浏览器自身缓存中查找是否有目标域名和对应的IP地址。

- 从本地电脑的hosts文件查找是否有存储DNS信息。

- 从路由器的缓存DNS信息中查找。

- ISP DNS缓存查找，从网络服务商（比如电信）的DNS缓存信息中查找。

- 经由以上几种方法还没查找到目标URL对应的IP的话，就会向根域名DNS服务器查找目标URL的对应IP，根域名服务器会向下级服务器转送请求，层层下发，直至找到对应IP为止

## 具体经历过程

### 1. DNS域名解析

### 2. 建立TCP连接

    TCP三次握手🤝
>第一次握手：

建立连接时，客户端（浏览器）发送syn包（syn=j）到服务器，并进入SYN_SENT状态（已发送），等待服务器确认；（浏览器：我要连接你啦） SYN：同步序列编号（Synchronize Sequence Numbers）。  

>第二次握手：

服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；（服务器收到请求，并回复：同意你连接）

>第三次握手：

客户端（浏览器）收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。（浏览器回复：收到你的回复，）

### 3. 发送HTTP请求

三次握手结束后，开始发送 HTTP 请求报文。
HTTP/1.1协议中共定义了八种方法（也叫“动作”） GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE。其中较为常用的又GET、POST、PUT方法；

### 4. 服务器处理请求

### 5. 返回响应结果

### 6. 关闭TCP连接

为了避免服务器与客户端双方的资源占用和损耗，当双方没有请求或响应传递时，任意一方都可以发起关闭请求。与创建TCP连接的3次握手类似，关闭TCP连接，需要4次握手。

### 7. 浏览器解析HTML

1. 构建DOM Tree

>+ 当浏览器接收到服务器响应来的HTML文档后，会遍历文档节点，生成DOM Tree

2. 构建CSSOM(css对象模型)

>+ 浏览器的CSS Parser将CSS解析成Style Rules，Style Rules也叫CSSOM（CSS Object Model）。

3. 构建Render Tree

>+ DOM Tree和CSSOM我们便可以构建Render Tree。浏览器会先从DOM Tree的根节点开始遍历每个可见节点。对每个可见节点，找到其适配的CSS样式规则并应用。这中间包括了两个步骤，<b>样式计算</b>和<b>样式覆盖</b>

4. 布局（Layout）

>+创建渲染树后，下一步就是布局（Layout）,或者叫回流（reflow,relayout），这个过程就是通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸，将其安置在浏览器窗口的正确位置，而有些时候我们会在文档布局完成后对DOM进行修改，这时候可能需要重新进行布局，也可称其为回流，本质上还是一个布局的过程，每一个渲染对象都有一个布局或者回流方法，实现其布局或回流。

5. 绘制（Painting）

### 8. JS加载

1. 创建window对象
2. 加载文件
3. 预编译
4. 解释执行

## 参考文档

[浏览器页面加载过程](https://juejin.im/post/6844903829251555341)
[一个页面从输入 URL 到页面加载显示完成，这个过程中都发生了什么](https://juejin.im/post/6844903822196736014)
[前端必会！四步带你吃透浏览器渲染基本原理](https://blog.csdn.net/csdnnews/article/details/95267307)